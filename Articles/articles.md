# ZeroBook 記事ネタ案

---

## 記事1: 店舗予約システムにおける「シンプル化」の意味

### 概要
店舗向け予約システムを設計する際、機能を増やすことよりも「削除すること」が重要になる理由を、認証方式の選択と外部連携の扱いから考察する。

### キーポイント
- Email/Password認証に統一した設計判断の背景
- 外部サービス依存がもたらす運用コストの構造
- マルチプラットフォーム対応における認証方式の一貫性
- 店舗オーナーにとっての「学習コスト」と「運用コスト」のバランス

---

## 記事2: 予約管理における「シフト提出」と「ブロック設定」の構造的違い

### 概要
スタッフの勤務時間管理において、「シフト提出機能」と「ブロック設定機能」は表面的には似ているが、設計思想と実装構造が異なる。両者の違いと、なぜブロック設定が小規模店舗に適しているかを分析する。

### キーポイント
- シフト提出が前提とする「事前計画型」業務フロー
- ブロック設定が前提とする「事後調整型」業務フロー
- スタッフの心理的負担の違い
- システムとしてのデータ構造の複雑さの比較

---

## 記事3: JSONBによる動的フォーム設計がもたらす柔軟性

### 概要
予約フォームのフィールド定義をJSONBで保存する設計により、固定スキーマではなく柔軟な設定が可能になる。この設計判断が店舗の多様なニーズに対応できる理由を考察する。

### キーポイント
- 固定スキーマ（カラム追加）と動的スキーマ（JSONB）の設計比較
- 店舗ごとに異なる「必要な項目」に対応する構造
- マイグレーション不要で機能追加が可能な設計のメリット
- JSONBの検索性とパフォーマンスへの影響

---

## 記事4: 予約システムにおける「承認制」の設計と実装

### 概要
オンライン予約を自動確定ではなく承認待ちにする「承認制」機能は、店舗の業務フローを大きく変える。この機能をステータス管理として設計する際の考慮点を整理する。

### キーポイント
- 予約ステータス（pending/confirmed/rejected）の状態遷移設計
- 承認制有効時の予約作成フロー
- 承認待ち予約の通知設計
- 店舗側の業務負担と顧客満足度のバランス

---

## 記事5: ダブルブッキング防止の実装アプローチ

### 概要
同時刻に複数の予約が入る「ダブルブッキング」を防止するには、単なる重複チェックではなく、原子的（atomic）な予約作成が必要になる。データベース関数を使った実装の理由を説明する。

### キーポイント
- 並行リクエストによる競合状態の発生メカニズム
- SELECT → INSERT の非原子性がもたらす問題
- データベース関数（RPC）による原子的予約作成
- FOR UPDATE ロックによる排他制御の設計

---

## 記事6: 空き状況計算における「営業時間」「休業日」「ブロック」の統合処理

### 概要
予約システムの空き状況計算は、営業時間・定休日・祝日・スタッフブロック・既存予約を統合的に考慮する必要がある。これらを単一の判定ロジックに統合する設計思想を解説する。

### キーポイント
- 営業時間設定の曜日別管理構造
- 祝日データの自動同期とカスタム休業日の扱い
- スタッフブロックと予約の重複判定アルゴリズム
- 時間帯の重複判定における境界条件の処理

---

## 記事7: 店舗予約システムにおける「メニューID」の型設計

### 概要
データベース設計において、メニューIDをUUIDではなくTEXT型で定義する判断には、実務上の理由がある。この設計判断の背景と、それがもたらす柔軟性を考察する。

### キーポイント
- UUID型とTEXT型の設計比較
- 店舗側でのメニュー管理の実際の運用フロー
- 外部システム連携時のIDの扱い
- データ整合性と実用性のバランス

---

## 記事8: Row Level Security（RLS）によるマルチテナント設計

### 概要
店舗ごとにデータを分離するマルチテナント設計において、アプリケーション層での権限チェックではなく、データベース層でのRow Level Securityを採用する理由と、その設計パターンを解説する。

### キーポイント
- アプリケーション層とデータベース層でのセキュリティ境界
- RLSポリシーの設計パターン（所有者ベース、会社ベース、公開データ）
- 公開フォーム（is_active=true）の特殊な扱い
- セキュリティホールを防ぐための「デフォルト拒否」原則

---

## 記事9: 予約システムにおける「予約経路」の記録と分析

### 概要
予約データに「source」カラム（online_form/manual_phone/manual_line/manual_walkin）を記録することの意味は、単なる分類ではない。集客チャネルの効果測定と業務改善につながる設計思想を説明する。

### キーポイント
- 予約経路の分類がもたらす業務分析の可能性
- 電話予約とオンライン予約の処理フローの違い
- 埋め込み元ドメイン（referrer_domain）による効果測定
- データの構造化がもたらす将来の拡張性

---

## 記事10: マルチプラットフォーム対応における「Single Source of Truth」の設計

### 概要
Web版・iOS版・Android版が同一のデータを参照する際、データの「正」をどこに置くかは設計の根幹に関わる。SupabaseをSSOTとする設計判断の理由と、プラットフォーム間のデータ整合性の保証方法を解説する。

### キーポイント
- データの「正」をデータベースに置く設計思想
- プラットフォーム間での型定義の整合性管理
- リアルタイム更新（Supabase Realtime）による同期
- クライアント側キャッシュとデータベースの整合性

---

## 記事11: 埋め込み予約フォームにおけるShadow DOMの活用

### 概要
他サイトに埋め込む予約フォームは、ホストページのCSS影響を受けない設計が必要になる。Shadow DOMを活用した埋め込み設計の理由と、その実装パターンを解説する。

### キーポイント
- iframeとShadow DOMの設計比較
- Shadow DOMによるCSS分離の仕組み
- 1行コードで埋め込み可能にする設計
- スクリプトの多重ロード防止の実装

---

## 記事12: 店舗向けSaaSにおける「サブスクリプション設計」と制限の考え方

### 概要
月額980円で「予約無制限」「スタッフ無制限」を提供する料金設計は、従来の「予約数に応じた従量課金」とは異なる思想に基づいている。この設計判断の背景と、それがもたらす価値を考察する。

### キーポイント
- 従量課金と定額制の設計思想の違い
- 店舗規模による利用量の違いと料金設計
- 「無制限」がもたらす心理的負担の軽減
- 予測可能なコスト構造がもたらす価値

---

## 記事13: 予約システムにおける「通知設計」の階層構造

### 概要
予約システムの通知は、メール通知・プッシュ通知・リアルタイム更新の3層で構成される。それぞれの役割と、なぜこれらを分離して設計する必要があるかを説明する。

### キーポイント
- メール通知の非同期性と確実性
- プッシュ通知の即時性とデバイス依存性
- リアルタイム更新による状態同期
- 通知チャネルの選択基準と実装コスト

---

## 記事14: 店舗予約システムにおける「承認待ち予約」の業務フロー設計

### 概要
オンライン予約を自動確定ではなく承認待ちにする設計は、店舗側の業務フローを考慮する必要がある。承認待ち一覧の表示、承認/拒否の操作、顧客への通知を統合的に設計する際の考え方を解説する。

### キーポイント
- 承認待ち予約の優先順位付けと表示設計
- 承認/拒否操作のUI設計と確認フロー
- 拒否時の顧客への通知設計
- 承認制の有効/無効を切り替える設定の扱い

---

## 記事15: 予約フォームの「テーマカスタマイズ」とデザインシステム

### 概要
予約フォームのテーマ設定をJSONBで保存し、プライマリカラーや背景色をカスタマイズ可能にする設計は、店舗のブランドイメージを反映させるためのもの。この設計がもたらす柔軟性と制約を考察する。

### キーポイント
- デザインシステムにおける「テーマ」の扱い
- JSONBによる柔軟な設定保存と型安全性
- カスタマイズの範囲とデザインの一貫性のバランス
- プレビュー機能の実装設計

---

## 記事16: 予約システムにおける「スタッフ管理」の二重構造

### 概要
ZeroBookでは「form_staffs」（フォーム単位のスタッフ）と「staffs」（会社単位のスタッフ）が分離されている。この二重構造の設計理由と、それぞれの責務を整理する。

### キーポイント
- フォーム単位と会社単位のスタッフ管理の違い
- 指名予約におけるスタッフ選択の設計
- スタッフブロック（休憩・休暇）のスコープ
- スタッフ招待機能とスタッフアプリの認証設計

---

## 記事17: リアルタイム更新による「最新状態の保証」設計

### 概要
Supabase Realtimeを活用して、予約一覧や空き状況を自動更新する設計は、ユーザーが手動リロードする必要をなくす。この設計の実装パターンと、コネクション管理の考慮点を解説する。

### キーポイント
- WebSocket接続によるリアルタイム通信の仕組み
- チャネル購読のスコープ設計（全体/フォーム単位）
- コネクションのライフサイクル管理とクリーンアップ
- ネットワーク切断時の再接続処理

---

## 記事18: 店舗予約システムにおける「手動予約登録」の設計思想

### 概要
オンライン予約だけでなく、電話・LINE・口頭での予約を手動登録する機能は、店舗の実際の業務フローに不可欠。この機能を「source」カラムで分類する設計の意味を考察する。

### キーポイント
- オンライン予約と手動予約の処理フローの違い
- 手動予約登録時の入力項目の設計
- 予約経路の記録による業務分析の可能性
- 店舗側の操作負担を最小化するUI設計

---

## 記事19: 予約システムにおける「定休日」と「祝日」の統合管理

### 概要
営業日を決定する際、「定休日」（週単位の繰り返し）と「祝日」（年単位のカレンダー）を統合的に扱う必要がある。この設計の実装パターンと、カスタム休業日の扱いを解説する。

### キーポイント
- 定休日の曜日配列による設定設計
- 祝日データの自動同期（holidays-jp等）
- カスタム休業日の追加と優先順位
- 空き状況計算における休業日の統合判定

---

## 記事20: 予約システムにおける「タイムゾーン」の扱い

### 概要
予約日時を保存する際、タイムゾーンをどう扱うかは、システムの整合性に影響する。TIMESTAMPTZによるUTC保存と、アプリケーション層での変換という設計パターンを解説する。

### キーポイント
- タイムゾーンの問題が発生するケース
- UTC保存による統一とアプリ側変換の設計
- 日付と時刻の分離保存（date + time）の設計理由
- 顧客のタイムゾーンと店舗のタイムゾーンの違いの扱い

---

## 記事21: 店舗予約システムにおける「予約ステータス」の状態遷移設計

### 概要
予約の状態をpending/confirmed/completed/cancelled/rejectedで管理する設計は、業務フローを反映している。各ステータスの意味と、許容される状態遷移を整理する。

### キーポイント
- 予約ステータスの意味と役割
- 状態遷移の許可パターンと禁止パターン
- 承認制有効時のpending → confirmed/rejected遷移
- キャンセル済み予約の保持と表示設計

---

## 記事22: 予約システムにおける「インデックス設計」とクエリパフォーマンス

### 概要
予約データの検索・フィルタリングを高速化するため、適切なインデックス設計が必要になる。複合インデックスと部分インデックスの活用パターンを解説する。

### キーポイント
- 予約一覧のクエリパターンとインデックス設計
- 複合インデックス（form_id, date, status）の設計理由
- 部分インデックス（WHERE status != 'cancelled'）の活用
- 空き状況計算におけるクエリパフォーマンス最適化

---

## 記事23: 店舗向けSaaSにおける「無料プラン」の設計思想

### 概要
月10件までの予約を無料で提供する「Freeプラン」は、単なるマーケティング施策ではない。店舗がシステムを試用し、価値を実感するための設計思想がある。

### キーポイント
- 無料プランと有料プランの機能差の設計
- 制限数の設定根拠（月10件という数字の意味）
- フリープランから有料プランへの移行促進設計
- 無料ユーザーのサポートコストと収益化のバランス

---

## 記事24: 予約システムにおける「メールテンプレート」のカスタマイズ設計

### 概要
予約確認メールやリマインダーメールのテンプレートをユーザーがカスタマイズできる設計は、店舗のブランドイメージを反映させるため。この設計の実装パターンと、デフォルトテンプレートの扱いを解説する。

### キーポイント
- メールテンプレートのイベントタイプ分類
- テンプレート変数の設計（{{customer_name}}等）
- プレビュー機能の実装設計
- デフォルトテンプレートとカスタムテンプレートの関係

---

## 記事25: マルチプラットフォーム対応における「認証トークン」の管理

### 概要
Web版・iOS版・Android版で異なる認証方式（Supabase Auth JWT / スタッフトークン）を扱う設計の理由と、それぞれのトークンのライフサイクル管理を解説する。

### キーポイント
- 管理者認証（Supabase Auth）とスタッフ認証（独自トークン）の分離
- スタッフアプリにおけるトークンベース認証の設計
- トークンの有効期限とリフレッシュの扱い
- セキュリティと利便性のバランス

---

## 記事26: 予約システムにおける「外部キー制約」と「ON DELETE」の設計判断

### 概要
データベースの外部キー制約において、ON DELETE CASCADE と ON DELETE SET NULL を使い分ける設計判断の理由を、予約データの整合性維持という観点から解説する。

### キーポイント
- フォーム削除時の予約データの扱い（CASCADE）
- メニュー・店舗削除時の予約データの扱い（SET NULL）
- データの参照整合性と業務要件のバランス
- 履歴データの保持と削除の設計思想

---

## 記事27: 店舗予約システムにおける「営業時間設定」の柔軟性設計

### 概要
曜日別に営業時間を設定し、中休憩時間を考慮する設計は、店舗の多様な営業パターンに対応するため。この設計がもたらす柔軟性と、実装の複雑さのトレードオフを考察する。

### キーポイント
- 曜日別営業時間設定のデータ構造
- 中休憩時間の設定と空き状況計算への反映
- 年中無休フラグと定休曜日の設定の関係
- 営業時間変更時の予約データへの影響

---

## 記事28: 予約システムにおける「公開フォーム」と「非公開フォーム」の分離設計

### 概要
予約フォームを「公開」（is_active=true）と「非公開」で分ける設計は、開発中のフォームと本番フォームを区別するため。この設計がもたらす運用上のメリットを解説する。

### キーポイント
- is_activeフラグによる公開状態の制御
- 公開フォームのRLSポリシー設計（誰でも閲覧可能）
- 非公開フォームのアクセス制御
- フォーム公開前のプレビュー機能の設計

---

## 記事29: 店舗予約システムにおける「データ構造の正規化」と「非正規化」のバランス

### 概要
予約データに「duration」をコピー保存する設計は、メニュー削除後も履歴データが保持できるため。正規化の原則と実用性のバランスを取った設計判断を解説する。

### キーポイント
- データ正規化の原則とその限界
- 履歴データの保持における参照整合性の問題
- 予約データへの「duration」コピー保存の設計理由
- データ整合性と実用性のトレードオフ

---

## 記事30: 予約システムにおける「エラーハンドリング」と「ログ設計」

### 概要
予約システムの運用において、エラーの記録と分析は重要。error_logsテーブルによる構造化ログ設計と、その活用パターンを解説する。

### キーポイント
- エラーログの構造化保存（JSONBによるメタデータ）
- エラー発生時のコンテキスト情報の記録
- ログ分析によるシステム改善のサイクル
- ユーザー体験を損なわないエラー表示設計

